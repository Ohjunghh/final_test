<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>HTML 템플릿 미리보기 및 커스터마이즈</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 30px;}
        .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px #0001; padding: 32px; }
        .input-row { margin-bottom: 10px; }
        label { font-weight: 600; }
        .preview-title { margin-top: 32px; font-size: 18px; color: #4263eb; }
        .preview-box { border:1px solid #ccc; padding:24px; margin-top:8px; background:#fafbfc; border-radius:8px; min-height:200px; }
        .download-btn { margin-top:20px; background:#4263eb; color:#fff; border:none; padding:12px 28px; border-radius:6px; font-size:16px; cursor:pointer; }
        .download-btn:hover { background:#2749b8; }
    </style>
</head>
<body>
<div class="container">
    <h2>HTML 템플릿 미리보기 및 커스터마이즈</h2>
    <div id="inputs"></div>
    <button class="download-btn" onclick="downloadHTML()">HTML 다운로드</button>
    <div class="preview-title">미리보기</div>
    <div class="preview-box" id="preview"></div>
</div>
<script>
// === 실제로는 아래 htmlTemplate를 서버에서 받아오세요 ===
let htmlTemplate = `
<!--https://yourcompany.com -> 회사 url로 수정-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Message</title>
</head>
<body>
  <h1>[고객명]님, 생일을 진심으로 축하드립니다!</h1>
  <p>오늘 하루, 소중한 분과 행복한 시간 보내시길 바랍니다.</p>
  <p>감사의 마음을 담아 [쿠폰/할인 혜택]을 선물로 드립니다.</p>
  <a href="[회사URL]">View in browser</a>
  <p><img src="[이미지URL]" width="200"></p>
  <p>From [회사명]</p>
</body>
</html>
`;

// === 치환필드 자동 추출 ===
const fields = Array.from(htmlTemplate.matchAll(/\[([^\]]+)\]/g)).map(m=>m[1]);

// === input box 생성 ===
const inputsDiv = document.getElementById('inputs');
fields.forEach(field => {
    const row = document.createElement('div');
    row.className = 'input-row';
    row.innerHTML = `<label>${field}: <input type="text" id="${field}" value=""></label>`;
    inputsDiv.appendChild(row);
});

// === 미리보기 및 치환 함수 ===
function updatePreview() {
    let html = htmlTemplate;
    fields.forEach(field => {
        const value = document.getElementById(field).value || `[${field}]`;
        html = html.replaceAll(`[${field}]`, value);
    });
    document.getElementById('preview').innerHTML = html;
}
inputsDiv.addEventListener('input', updatePreview);
updatePreview();

// === 다운로드 함수 ===
function downloadHTML() {
    let html = htmlTemplate;
    fields.forEach(field => {
        const value = document.getElementById(field).value || `[${field}]`;
        html = html.replaceAll(`[${field}]`, value);
    });
    const blob = new Blob([html], {type: "text/html"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "custom_template.html";
    a.click();
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
